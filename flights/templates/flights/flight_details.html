{% extends 'base.html' %}

{% block title %}Flight Details{% endblock %}

{% block extra_css %}
<style>
    .details-card {
        border: 0;
        border-radius: 1rem;
        box-shadow: 0 0.5rem 1rem 0 rgba(0, 0, 0, 0.05);
        background-color: #ffffff;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            
            <div class="mb-3">
                <a href="{% url 'passenger_dashboard' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-2"></i> Back to Search
                </a>
            </div>

            <div class="card details-card">
                <div class="card-body p-4 p-sm-5">
                    
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <h2 class="mb-0">Flight {{ flight.flight_number }}</h2>
                            <p class="fs-5 text-muted mb-0">
                                {{ flight.departure_airport.city }} ({{ flight.departure_airport.airport_code }}) 
                                to 
                                {{ flight.arrival_airport.city }} ({{ flight.arrival_airport.airport_code }})
                            </p>
                        </div>
                        <div class="text-end">
                            <h3 class="mb-0 text-primary">{{ flight.economy_price }} SAR</h3>
                            <span class="text-muted">per passenger (Economy)</span>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <h6 class="text-muted">Departure</h6>
                            <h5><i class="bi bi-calendar-event me-2"></i> {{ flight.departure_datetime|date:"M d, Y" }}</h5>
                            <h5><i class="bi bi-clock me-2"></i> {{ flight.departure_datetime|time:"H:i" }}</h5>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-muted">Arrival</h6>
                            <h5><i class="bi bi-calendar-event me-2"></i> {{ flight.arrival_datetime|date:"M d, Y" }}</h5>
                            <h5><i class="bi bi-clock me-2"></i> {{ flight.arrival_datetime|time:"H:i" }}</h5>
                        </div>
                        <div class="col-md-4">
                            <h6 class="text-muted">Flight Info</h6>
                            <p class="mb-1"><strong>Duration:</strong> {{ flight.flight_time }}</p>
                            <p class="mb-1"><strong>Aircraft:</strong> {{ flight.aircraft.model }}</p>
                        </div>
                    </div>
                    
                    <hr class="my-4">

                    <form action="{% url 'seat_selection' %}" method="get">
                        <input type="hidden" name="flight_id" value="{{ flight.flight_number }}">
                        
                        <h4 class="mb-3 text-center">Select Passengers</h4>
                        <div class="row justify-content-center">
                            <div class="col-md-8">
                                <div class="row g-3">
                                    <div class="col-sm-6">
                                        <label for="adultsCount" class="form-label">Adults (12+)</label>
                                        <input type="number" name="adults" class="form-control form-control-lg" id="adultsCount" value="1" min="1" required>
                                    </div>
                                    <div class="col-sm-6">
                                        <label for="childrenCount" class="form-label">Children (below 12)</label>
                                        <input type="number" name="children" class="form-control form-control-lg" id="childrenCount" value="0" min="0" required>
                                    </div>
                                </div>
                                
                                <div class="text-center mt-4">
                                    <h5 class="mb-0">Total Passengers: <span id="totalPassengers" class="text-primary fw-bold">1</span></h5>
                                </div>

                                <div class="d-grid mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        Select Seats <i class="bi bi-arrow-right-short"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div> 
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const adultsInput = document.getElementById("adultsCount");
        const childrenInput = document.getElementById("childrenCount");
        const totalDisplay = document.getElementById("totalPassengers");

        function updateTotal() {
            const adults = parseInt(adultsInput.value) || 0;
            const children = parseInt(childrenInput.value) || 0;
            const total = adults + children;
            
            totalDisplay.textContent = total;
        }

        adultsInput.addEventListener("input", updateTotal);
        childrenInput.addEventListener("input", updateTotal);
    });
</script>
{% endblock %}